<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#3e6bff" />
<meta name="description" content="ê³¨í”„ í´ëŸ½ ì„ íƒì„ ë„ì™€ì£¼ëŠ” ê³„ì‚°ê¸° - ê³ ì €ì°¨, í’ì†, ë¼ì´ ì¡°ê±´ì„ ê³ ë ¤í•œ ì •í™•í•œ í´ëŸ½ ì¶”ì²œ" />
<link rel="manifest" href="manifest.json" />
<link rel="apple-touch-icon" href="cd5cc840-4fba-47c4-b991-226ea22f2891.png" />
<title>ê³¨í”„ í´ëŸ½ ê³„ì‚°ê¸°</title>
<style>
:root{
  --bg:#f2f5f9;
  --card:#f8fafc;
  --muted:#9aa6bf;
  --accent:#3e6bff;
  --accent-dark:#2a4fcc;
  --red:#ff4d4d;
  --blue:#3a86ff;
  --glass: rgba(255,255,255,0.6);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: -apple-system, BlinkMacSystemFont, "Pretendard","Apple SD Gothic Neo","Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: var(--bg);
  -webkit-font-smoothing:antialiased;
  padding:16px;
  background-image: url('image (2).png');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  background-attachment: fixed;
  position: relative;
}
body::before{
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(242,245,249,0.75);
  backdrop-filter: blur(8px);
  z-index: -1;
}
.app-shell{max-width:920px;margin:0 auto;}
.app-header{
  display:flex;align-items:center;gap:12px;margin-bottom:14px;
  padding:8px 12px;border-radius:14px;
  background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
  box-shadow: 8px 8px 16px rgba(210,215,222,0.8), -8px -8px 16px #ffffff;
}
.app-icon{
  width:60px;
  height:60px;
  border-radius:12px;
  object-fit:contain;
  padding:6px;
  background:#fff;
  box-shadow: 4px 4px 8px rgba(0,0,0,0.1);
}
.app-title{font-size:20px;color:var(--accent);font-weight:700}
.main-area{display:flex;flex-direction:column;gap:16px;padding-bottom:40px}
.card{background:var(--card);border-radius:16px;padding:16px;box-shadow:8px 8px 20px rgba(210,215,222,0.9), -8px -8px 20px #ffffff;}
.inputs-card{display:flex;flex-direction:column;gap:12px;}

.input-grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:12px;
}

.field{
  display:flex;
  flex-direction:column;
}

.env-section{
  padding:14px;
  border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
  box-shadow:inset 4px 4px 8px rgba(208,213,219,0.6), inset -4px -4px 8px #ffffff;
}

.env-section-title{
  font-size:13px;
  color:var(--muted);
  margin-bottom:10px;
  font-weight:600;
  text-align:center;
}

.label{font-size:13px;margin-bottom:6px;color:#425273;font-weight:600;display:block}

input[type=number], .full-select, .small-select{
  width:100%;padding:12px;border-radius:12px;border:none;background:#eef1f6;box-shadow:inset 4px 4px 8px #d0d5db, inset -4px -4px 8px #ffffff;font-size:15px;
}
.small-select{width:120px}
.full-select{width:100%}

/* ê³ ì €ì°¨ ìŠ¬ë¼ì´ë” */
.elev-slider-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  margin-top:8px;
}

.elev-slider{
  -webkit-appearance:none;
  appearance:none;
  width:100%;
  height:12px;
  border-radius:12px;
  background: linear-gradient(90deg, #3a86ff 0%, #a8c8ff 25%, #ffffff 50%, #ffb3b3 75%, #ff4d4d 100%);
  outline:none;
  position:relative;
}

.elev-slider::-webkit-slider-runnable-track{
  height:12px;
  border-radius:12px;
  background: linear-gradient(90deg, #3a86ff 0%, #a8c8ff 25%, #ffffff 50%, #ffb3b3 75%, #ff4d4d 100%);
}

.elev-slider::-moz-range-track{
  height:12px;
  border-radius:12px;
  background: linear-gradient(90deg, #3a86ff 0%, #a8c8ff 25%, #ffffff 50%, #ffb3b3 75%, #ff4d4d 100%);
}

.elev-slider::-webkit-slider-thumb{
  -webkit-appearance:none;
  height:24px;
  width:24px;
  border-radius:50%;
  background:linear-gradient(145deg,#fff,#eef4ff);
  box-shadow:3px 3px 8px rgba(0,0,0,0.15), -2px -2px 6px rgba(255,255,255,0.8);
  cursor:pointer;
  border:2px solid #fff;
}

.elev-slider::-moz-range-thumb{
  height:24px;
  width:24px;
  border-radius:50%;
  background:#fff;
  box-shadow:3px 3px 8px rgba(0,0,0,0.15);
  cursor:pointer;
  border:2px solid #fff;
}

.elev-value{
  font-weight:700;
  padding:8px 14px;
  border-radius:12px;
  background:var(--glass);
  box-shadow:6px 6px 12px rgba(205,211,219,0.8), -6px -6px 12px #ffffff;
  color:#333;
  min-width:80px;
  text-align:center;
}

/* í’ì† ìŠ¬ë¼ì´ë” */
.wind-slider-wrap{
  margin-top:8px;
}

.wind-slider{
  width:100%;
  height:12px;
  appearance:none;
  border-radius:12px;
  background:#e6eef9;
  outline:none;
}

.wind-slider::-webkit-slider-runnable-track{
  height:12px;
  border-radius:12px;
  background:linear-gradient(90deg,#ffffff 0%,#cfe0ff 100%);
}

.wind-slider::-moz-range-track{
  height:12px;
  border-radius:12px;
  background:linear-gradient(90deg,#ffffff 0%,#cfe0ff 100%);
}

.wind-slider::-webkit-slider-thumb{
  -webkit-appearance:none;
  height:24px;
  width:24px;
  border-radius:50%;
  background:linear-gradient(145deg,#fff,#eef4ff);
  box-shadow:3px 3px 8px rgba(0,0,0,0.15), -2px -2px 6px rgba(255,255,255,0.8);
  cursor:pointer;
  border:2px solid #fff;
  margin-top:-6px;
}

.wind-slider::-moz-range-thumb{
  height:24px;
  width:24px;
  border-radius:50%;
  background:#fff;
  box-shadow:3px 3px 8px rgba(0,0,0,0.15);
  cursor:pointer;
  border:2px solid #fff;
}

.wind-info{
  display:flex;
  align-items:center;
  justify-content:center;
  margin-top:10px;
}

.wind-value{
  font-weight:700;
  color:#10316b;
  padding:6px 12px;
  border-radius:8px;
  background:rgba(255,255,255,0.5);
  box-shadow:3px 3px 6px rgba(205,211,219,0.6);
}

.wind-direction-controls{
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-top:12px;
}

.wind-checkbox{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px 12px;
  border-radius:10px;
  background:rgba(255,255,255,0.4);
  box-shadow:3px 3px 6px rgba(205,211,219,0.5);
  cursor:pointer;
  transition:all 0.2s;
}

.wind-checkbox:hover{
  background:rgba(255,255,255,0.6);
  box-shadow:4px 4px 8px rgba(205,211,219,0.6);
}

.wind-checkbox input[type="checkbox"]{
  width:20px;
  height:20px;
  cursor:pointer;
  accent-color:var(--accent);
}

.wind-checkbox span{
  font-size:14px;
  font-weight:600;
  color:#425273;
}

.hint{font-size:11px;color:var(--muted);margin-top:6px;text-align:center}

.voice-status{
  margin-top:12px;
  padding:16px;
  border-radius:12px;
  background:linear-gradient(180deg, rgba(62,107,255,0.1), rgba(62,107,255,0.05));
  border:2px dashed var(--accent);
}

.voice-animation{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  margin-bottom:12px;
}

.pulse{
  width:16px;
  height:16px;
  border-radius:50%;
  background:var(--accent);
  animation:pulse 1.5s ease-in-out infinite;
}

@keyframes pulse{
  0%, 100%{
    transform:scale(1);
    opacity:1;
  }
  50%{
    transform:scale(1.3);
    opacity:0.6;
  }
}

.voice-text{
  font-size:15px;
  font-weight:600;
  color:var(--accent);
}

.voice-guide{
  text-align:left;
  padding:12px;
  background:rgba(255,255,255,0.6);
  border-radius:8px;
  margin-top:12px;
}

.voice-guide-title{
  font-size:13px;
  font-weight:700;
  color:var(--accent);
  margin-bottom:10px;
  text-align:center;
}

.voice-keywords{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-bottom:12px;
}

.keyword-group{
  font-size:11px;
  line-height:1.6;
  color:#425273;
}

.keyword-group strong{
  color:var(--accent);
  font-weight:700;
  display:block;
  margin-bottom:2px;
}

.voice-example{
  font-size:12px;
  padding:8px;
  background:rgba(62,107,255,0.1);
  border-radius:6px;
  border-left:3px solid var(--accent);
  color:#425273;
  line-height:1.6;
}

.voice-example strong{
  color:var(--accent);
  font-weight:700;
}

.voice-help{
  font-size:12px;
  color:var(--muted);
  font-style:italic;
}

.fine-tune-buttons{
  display:flex;
  justify-content:center;
  gap:6px;
  margin-top:10px;
  flex-wrap:wrap;
}

.fine-btn{
  padding:6px 12px;
  border:none;
  border-radius:8px;
  background:linear-gradient(145deg, #ffffff, #f5f7fa);
  box-shadow:3px 3px 6px rgba(184,192,208,0.4), -3px -3px 6px #ffffff;
  font-size:12px;
  font-weight:600;
  color:#425273;
  cursor:pointer;
  transition:all 0.2s;
  min-width:50px;
}

.fine-btn:hover{
  background:linear-gradient(145deg, #f5f7fa, #e8ecf1);
  transform:translateY(-1px);
}

.fine-btn:active{
  transform:translateY(0) scale(0.98);
  box-shadow:2px 2px 4px rgba(184,192,208,0.4), -2px -2px 4px #ffffff;
}

.row{display:flex;gap:8px}
.gap{gap:10px}
.button{border:none;padding:12px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:6px 6px 12px rgba(184,192,208,0.6), -6px -6px 12px #ffffff;transition:all 0.2s}
.button.primary{background:linear-gradient(145deg,var(--accent),var(--accent-dark));color:#fff}
.button.outline{background:transparent;border:1px solid rgba(66,82,115,0.06);color:var(--accent);}
.button:active{transform:scale(0.98)}

.club-display{
  margin:12px 0;
  padding:12px;
  border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
  box-shadow:inset 4px 4px 8px rgba(208,213,219,0.6), inset -4px -4px 8px #ffffff;
  min-height:80px;
}
.club-display-title{
  font-size:13px;
  color:var(--muted);
  margin-bottom:8px;
  font-weight:600;
}
.club-chips{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}
.club-chip{
  display:inline-flex;
  align-items:center;
  padding:6px 12px;
  border-radius:8px;
  background:#fff;
  box-shadow:3px 3px 6px rgba(210,215,222,0.7), -3px -3px 6px #ffffff;
  font-size:13px;
  font-weight:600;
  color:#425273;
}
.club-chip-name{
  color:var(--accent);
  margin-right:6px;
}
.club-empty{
  color:var(--muted);
  font-size:13px;
  text-align:center;
  padding:20px;
}

.result-card{overflow:hidden;min-height:120px;transition:transform .28s ease,opacity .28s ease;opacity:0;transform:translateY(8px) scale(.995);display:none}
.result-card.show{opacity:1;transform:translateY(0) scale(1);display:block}
.result-content{display:flex;gap:12px;align-items:center}
.result-summary{flex:1;padding:12px}
.res-line{margin:8px 0;font-size:14px;line-height:1.6}
.res-line strong{color:var(--accent)}
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);padding:18px;z-index:1000}
.modal[aria-hidden="false"], .modal.show{display:flex}
.modal-card{width:100%;max-width:640px;background:var(--card);border-radius:14px;padding:18px;box-shadow:8px 8px 20px rgba(210,215,222,0.9), -8px -8px 20px #ffffff;position:relative;max-height:80vh;overflow-y:auto}
.modal-close{position:absolute;right:12px;top:12px;border:none;background:transparent;font-size:20px;cursor:pointer;color:#666}
.modal-close:hover{color:#000}
.modal-header{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.modal-icon{width:44px;height:44px}
.modal-sub{color:var(--muted);margin-top:6px;margin-bottom:10px;font-size:13px}
.club-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:12px 0}
.club-grid>div{display:flex;flex-direction:column;gap:4px}
.club-grid label{font-size:13px;color:#2a3b66;font-weight:600}
.club-grid input{padding:10px;border-radius:10px;border:none;background:#eef1f6;box-shadow:inset 4px 4px 8px #d0d5db,inset -4px -4px 8px #ffffff}
.modal-actions{display:flex;gap:10px;margin-top:12px;justify-content:flex-end}

@media (max-width:720px){
  .input-grid{grid-template-columns:1fr}
  .result-content{flex-direction:column}
  .club-grid{grid-template-columns:1fr}
  .voice-keywords{grid-template-columns:1fr}
}
</style>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <img src="cd5cc840-4fba-47c4-b991-226ea22f2891.png" alt="golf icon" class="app-icon" />
    <div class="app-title">ê³¨í”„ í´ëŸ½ ê³„ì‚°ê¸°</div>
  </header>

  <main class="main-area">
    <section class="card inputs-card">
      <div class="input-grid">
        <div class="field">
          <label class="label">ëª©í‘œ ê±°ë¦¬ (m)</label>
          <input id="tgt" type="number" placeholder="ì˜ˆ: 150" inputmode="decimal" />
        </div>

        <div class="env-section">
          <div class="env-section-title">ğŸŒ¡ï¸ ê³ ì €ì°¨</div>
          <div class="elev-slider-wrap">
            <input id="elev" class="elev-slider" type="range" min="-20" max="20" step="0.1" value="0" />
            <div class="elev-value" id="elevValue">0.0 m</div>
          </div>
          <div class="fine-tune-buttons">
            <button class="fine-btn" data-target="elev" data-amount="-1">-1m</button>
            <button class="fine-btn" data-target="elev" data-amount="-0.1">-0.1m</button>
            <button class="fine-btn" data-target="elev" data-amount="0.1">+0.1m</button>
            <button class="fine-btn" data-target="elev" data-amount="1">+1m</button>
          </div>
          <div class="hint">â† í•˜ê°• (íŒŒë€ìƒ‰) | ìƒìŠ¹ (ë¹¨ê°„ìƒ‰) â†’</div>
        </div>
      </div>

      <div class="env-section">
        <div class="env-section-title">ğŸ’¨ í’ì† & í’í–¥</div>
        <div class="wind-slider-wrap">
          <input id="wind" class="wind-slider" type="range" min="0" max="8" step="0.1" value="0" />
        </div>
        <div class="wind-info">
          <div class="wind-value" id="windValue">0.0 m/s</div>
        </div>
        <div class="fine-tune-buttons">
          <button class="fine-btn" data-target="wind" data-amount="-1">-1m/s</button>
          <button class="fine-btn" data-target="wind" data-amount="-0.1">-0.1m/s</button>
          <button class="fine-btn" data-target="wind" data-amount="0.1">+0.1m/s</button>
          <button class="fine-btn" data-target="wind" data-amount="1">+1m/s</button>
        </div>
        <div class="wind-direction-controls">
          <label class="wind-checkbox">
            <input type="checkbox" id="headwind" />
            <span>ë§ë°”ëŒ(ì—­í’)</span>
          </label>
          <label class="wind-checkbox">
            <input type="checkbox" id="tailwind" />
            <span>ë’·ë°”ëŒ(ìˆœí’)</span>
          </label>
          <label class="wind-checkbox">
            <input type="checkbox" id="crosswind" />
            <span>ì˜†ë°”ëŒ</span>
          </label>
        </div>
      </div>

      <div class="club-display">
        <div class="club-display-title">â›³ ì…ë ¥ëœ í´ëŸ½ ê±°ë¦¬</div>
        <div class="club-chips" id="clubChips">
          <div class="club-empty">í´ëŸ½ ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
        </div>
      </div>

      <div class="input-grid">
        <div class="field">
          <label class="label">ë¼ì´</label>
          <select id="lie" class="full-select">
            <option>í˜ì–´ì›¨ì´</option><option>ëŸ¬í”„</option><option>ë²™ì»¤</option>
          </select>
        </div>

        <div class="field">
          <label class="label">í•€ ìœ„ì¹˜</label>
          <select id="pin" class="full-select">
            <option>ì•í•€</option><option selected>ì¤‘ì•™</option><option>ë’·í•€</option>
          </select>
        </div>
      </div>

      <div class="row gap">
        <button id="voiceBtn" class="button outline">ğŸ¤ ìŒì„± ì…ë ¥</button>
        <button id="openClubBtn" class="button outline">í´ëŸ½ ê±°ë¦¬ ì…ë ¥</button>
        <button id="calcBtn" class="button primary">ê³„ì‚°í•˜ê¸°</button>
      </div>
      
      <div id="voiceStatus" class="voice-status" style="display:none;">
        <div class="voice-animation">
          <div class="pulse"></div>
          <span class="voice-text">ë“£ê³  ìˆìŠµë‹ˆë‹¤...</span>
        </div>
        <div class="voice-guide">
          <div class="voice-guide-title">ğŸ’¡ ìŒì„± ì…ë ¥ ê°€ì´ë“œ</div>
          <div class="voice-keywords">
            <div class="keyword-group">
              <strong>ê±°ë¦¬:</strong> "140ë¯¸í„°", "150m"
            </div>
            <div class="keyword-group">
              <strong>ë°”ëŒ:</strong> "ë§ë°”ëŒ", "ë’·ë°”ëŒ", "ì˜†ë°”ëŒ"
            </div>
            <div class="keyword-group">
              <strong>í’ì†:</strong> "ë§ë°”ëŒ 5", "í’ì† 3"
            </div>
            <div class="keyword-group">
              <strong>ê³ ì €ì°¨:</strong> "ì˜¤ë¥´ë§‰ 10", "ë‚´ë¦¬ë§‰ 5"
            </div>
            <div class="keyword-group">
              <strong>ë¼ì´:</strong> "í˜ì–´ì›¨ì´", "ëŸ¬í”„", "ë²™ì»¤"
            </div>
            <div class="keyword-group">
              <strong>í•€:</strong> "ì•í•€", "ì¤‘í•€", "ë’·í•€"
            </div>
          </div>
          <div class="voice-example">
            <strong>ğŸ“Œ ì˜ˆì‹œ:</strong> "140ë¯¸í„° ë’·ë°”ëŒ 3 ì˜¤ë¥´ë§‰ 10 ëŸ¬í”„ ì¤‘í•€"
          </div>
        </div>
      </div>
    </section>

    <section class="card result-card" id="resultCard" aria-hidden="true">
      <div id="resultContent" class="result-content">
        <div class="result-left">
          <div id="resultSummary" class="result-summary">ì¶”ì²œ ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
      </div>
    </section>
  </main>
</div>

<div id="clubModal" class="modal" aria-hidden="true">
  <div class="modal-card">
    <button id="modalClose" class="modal-close" aria-label="ë‹«ê¸°">âœ•</button>
    <div class="modal-header">
      <img src="cd5cc840-4fba-47c4-b991-226ea22f2891.png" alt="golf icon" class="modal-icon" />
      <h3>í´ëŸ½ë³„ ê±°ë¦¬ ì…ë ¥</h3>
    </div>
    <p class="modal-sub">ì‚¬ìš©í•˜ëŠ” í´ëŸ½ì˜ í‰ê·  ë¹„ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ë¹„ì›Œë‘ë©´ ì¶”ì²œ í›„ë³´ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.</p>

    <div class="club-grid" id="clubInputs"></div>

    <div class="modal-actions">
      <button id="saveClubs" class="button primary">ì €ì¥</button>
      <button id="closeModal" class="button outline">ì·¨ì†Œ</button>
    </div>
  </div>
</div>

<script>
// Logic and UI glue
const clubs = ["Driver","3W","5W","7W","3I","4I","5I","6I","7I","8I","9I","PW","AW","SW"];
let clubDistances = {};
clubs.forEach(c => clubDistances[c] = null);
const lieMultiplier = {"í˜ì–´ì›¨ì´":1.0,"ëŸ¬í”„":1.10,"ë²™ì»¤":1.20};
const pinAdjust = {"ì•í•€":2.0,"ì¤‘ì•™":0.0,"ë’·í•€":-2.0};

// í˜„ì‹¤ì ì¸ ê³ ì €ì°¨ ë³´ì • ê³µì‹
// ì—°êµ¬ ê²°ê³¼: 1m ìƒìŠ¹ ì‹œ ì•½ 1.05m ì§§ê²Œ, 1m í•˜ê°• ì‹œ ì•½ 0.90m ê¸¸ê²Œ í”Œë ˆì´ë¨
function elevation_delta(e, lie){
  if (e >= 0){
    // ìƒìŠ¹: ê³ ì €ì°¨ì˜ ì•½ 105%ê°€ ì¶”ê°€ ê±°ë¦¬ë¡œ í•„ìš”
    return e * 1.05;
  } else {
    // í•˜ê°•: ê³ ì €ì°¨ì˜ ì•½ 90%ë§Œí¼ ê±°ë¦¬ ê°ì†Œ
    // ë¼ì´ì— ë”°ë¼ ëŸ° ê±°ë¦¬ ì°¨ì´ ë°˜ì˜
    const lieRunFactor = {"í˜ì–´ì›¨ì´":0.90, "ëŸ¬í”„":0.95, "ë²™ì»¤":1.00};
    return e * (lieRunFactor[lie] || 0.90);
  }
}

function compute_corrected_distance(target, elev, wind_speed, isHeadwind, isTailwind, isCrosswind, lie, pin){
  const tgt_adj = target + (pinAdjust[pin] || 0);
  const d_elev = elevation_delta(elev, lie);
  const d1 = tgt_adj + d_elev;
  
  // ê³¨í”„ì¡´ ì •ë°€ë²• ë°”ëŒ ë³´ì • ê³µì‹ (ì—°ì† í•¨ìˆ˜ + ë¹„ëŒ€ì¹­)
  // ì—°êµ¬ ê²°ê³¼: ë§ë°”ëŒì´ ë’·ë°”ëŒë³´ë‹¤ ì•½ 1.6ë°° ë” í° ì˜í–¥
  let wind_adj = 0;
  
  if (wind_speed > 0 && (isHeadwind || isTailwind)) {
    // í’ì†ì— ë”°ë¥¸ ë³´ì • ë¹„ìœ¨ ê³„ì‚° (ì—°ì† í•¨ìˆ˜)
    let basePercent = 0;
    
    if (wind_speed <= 3) {
      // ì•½ë°”ëŒ: í’ì† 1ë‹¹ ì•½ 1.33%ì”© ì¦ê°€ (0â†’0%, 3â†’4%)
      basePercent = wind_speed * 0.0133;
    } else if (wind_speed <= 6) {
      // ì¤‘ë°”ëŒ: 3 m/sì—ì„œ 4%, 6 m/sì—ì„œ 8%ë¡œ ì„ í˜• ì¦ê°€
      basePercent = 0.04 + (wind_speed - 3) * 0.0133;
    } else {
      // ê°•ë°”ëŒ: 6 m/sì—ì„œ 8%, 8+ m/sì—ì„œ 15%ë¡œ ì„ í˜• ì¦ê°€
      basePercent = 0.08 + (wind_speed - 6) * 0.035;
      // ìµœëŒ€ 15%ë¡œ ì œí•œ
      if (basePercent > 0.15) basePercent = 0.15;
    }
    
    // 70m ì´í•˜ëŠ” ê±°ë¦¬ ë³€í™” ë¯¸ë¯¸ (íš¨ê³¼ 30%)
    if (tgt_adj <= 70) {
      basePercent = basePercent * 0.3;
    }
    
    if (isHeadwind && !isTailwind) {
      // ë§ë°”ëŒ(ì—­í’): ê±°ë¦¬ì˜ %ë§Œí¼ ì¶”ê°€ (í’€ íš¨ê³¼)
      let distanceAdd = tgt_adj * basePercent;
      
      // ì˜†ë°”ëŒ ìˆìœ¼ë©´ íš¨ê³¼ 75%
      if (isCrosswind) {
        distanceAdd *= 0.75;
      }
      
      wind_adj = distanceAdd;
      
    } else if (isTailwind && !isHeadwind) {
      // ë’·ë°”ëŒ(ìˆœí’): ê±°ë¦¬ì˜ %ë§Œí¼ ê°ì†Œ (ë§ë°”ëŒì˜ ì•½ 62.5% íš¨ê³¼)
      // ì—°êµ¬ ê²°ê³¼: ë’·ë°”ëŒì€ ë§ë°”ëŒë³´ë‹¤ íš¨ê³¼ê°€ ì•½í•˜ì§€ë§Œ ì²´ê°ë˜ëŠ” ìˆ˜ì¤€ìœ¼ë¡œ ì¡°ì •
      let distanceSubtract = tgt_adj * basePercent * 0.625;
      
      // ì˜†ë°”ëŒ ìˆìœ¼ë©´ íš¨ê³¼ë¥¼ ì¶”ê°€ë¡œ ê°ì†Œ (ì „ì²´ì˜ 60%)
      if (isCrosswind) {
        distanceSubtract *= 0.6;
      }
      
      wind_adj = -distanceSubtract;
    }
  }
  
  const d2 = d1 + wind_adj;
  const beforeLie = d2;
  const corrected = d2 * (lieMultiplier[lie] || 1.0);
  const lie_adj = corrected - beforeLie;
  
  return {corrected, d_elev, wind_adj, lie_adj, tgt_adj};
}

function qs(id){ return document.getElementById(id); }
function fmt(v){ return Number(v).toFixed(1); }

function buildClubInputs(){
  const container = qs('clubInputs');
  container.innerHTML = '';
  clubs.forEach(c=>{
    const wrap = document.createElement('div');
    const label = document.createElement('label');
    label.textContent = c;
    const input = document.createElement('input');
    input.type = 'number';
    input.id = 'ci_' + c;
    input.placeholder = 'ë¹„ê±°ë¦¬(m)';
    input.step = '1';
    input.addEventListener('input', ()=> {
      clubDistances[c] = input.value === '' ? null : parseFloat(input.value);
    });
    wrap.appendChild(label);
    wrap.appendChild(input);
    container.appendChild(wrap);
  });
}

function updateClubDisplay(){
  const container = qs('clubChips');
  const hasClubs = clubs.some(c => clubDistances[c] != null);
  
  if(!hasClubs){
    container.innerHTML = '<div class="club-empty">í´ëŸ½ ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
    return;
  }
  
  container.innerHTML = '';
  clubs.forEach(c => {
    if(clubDistances[c] != null){
      const chip = document.createElement('div');
      chip.className = 'club-chip';
      chip.innerHTML = `<span class="club-chip-name">${c}</span>${clubDistances[c]}m`;
      container.appendChild(chip);
    }
  });
}

function updateElevUI(){
  const elev = parseFloat(qs('elev').value);
  const el = qs('elevValue');
  el.textContent = (elev>0?'+':'') + fmt(elev) + ' m';
  if (elev > 0) {
    el.style.background = 'linear-gradient(180deg, rgba(255,77,77,0.2), rgba(255,77,77,0.1))';
    el.style.color = '#b00000';
  } else if (elev < 0) {
    el.style.background = 'linear-gradient(180deg, rgba(58,134,255,0.2), rgba(58,134,255,0.1))';
    el.style.color = '#0b4bd6';
  } else {
    el.style.background = 'var(--glass)';
    el.style.color = '#333';
  }
}

function updateWindUI(){
  const wind = parseFloat(qs('wind').value);
  qs('windValue').textContent = fmt(wind) + ' m/s';
}

function loadSaved(){
  try{
    const raw = localStorage.getItem('golf_clubs_v1');
    if (raw){
      const obj = JSON.parse(raw);
      clubDistances = {...clubDistances, ...obj};
      clubs.forEach(c=>{
        const el = qs('ci_' + c);
        if (el && clubDistances[c] != null) el.value = clubDistances[c];
      });
      updateClubDisplay();
    }
  }catch(e){ console.warn(e); }
}

function saveClubsToStorage(){
  localStorage.setItem('golf_clubs_v1', JSON.stringify(clubDistances));
}

function computeAndShow(){
  if (Object.values(clubDistances).every(v => v === null)){
    alert('ë¨¼ì € í´ëŸ½ ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    return;
  }
  const tgt = parseFloat(qs('tgt').value || 0);
  if(!tgt || tgt <= 0){
    alert('ëª©í‘œ ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    return;
  }
  const elev = parseFloat(qs('elev').value || 0);
  const wind = parseFloat(qs('wind').value || 0);
  const isHeadwind = qs('headwind').checked;
  const isTailwind = qs('tailwind').checked;
  const isCrosswind = qs('crosswind').checked;
  const lie = qs('lie').value;
  const pin = qs('pin').value;
  const res = compute_corrected_distance(tgt, elev, wind, isHeadwind, isTailwind, isCrosswind, lie, pin);
  const valid = clubs.filter(c=>clubDistances[c] != null).map(c=>[c, Math.abs(res.corrected - clubDistances[c])]);
  valid.sort((a,b)=>a[1]-b[1]);
  const best = valid[0][0];
  const sum = qs('resultSummary');
  sum.innerHTML = `
    <div class="res-line">ğŸ¯ <strong>ì¡°ì • ëª©í‘œ ê±°ë¦¬</strong>: ${fmt(res.tgt_adj)} m</div>
    <div class="res-line">â›° <strong>ê³ ì € ë³´ì •ëŸ‰</strong>: ${fmt(res.d_elev)} m</div>
    <div class="res-line">ğŸ’¨ <strong>ë°”ëŒ ë³´ì •ëŸ‰</strong>: ${fmt(res.wind_adj)} m</div>
    <div class="res-line">ğŸŒ¿ <strong>ë¼ì´ ë³´ì •ëŸ‰</strong>: ${fmt(res.lie_adj)} m</div>
    <div class="res-line">ğŸ“ <strong>ìµœì¢… í•„ìš” ê±°ë¦¬</strong>: ${fmt(res.corrected)} m</div>
    <hr style="border:none;border-top:1px solid #e0e0e0;margin:12px 0">
    <div class="res-line" style="font-size:18px;font-weight:700">ğŸ‘‰ ì¶”ì²œ í´ëŸ½: <strong style="color:var(--accent);font-size:22px">${best}</strong></div>
  `;
  const card = qs('resultCard');
  card.classList.add('show');
}

document.addEventListener('DOMContentLoaded', ()=>{
  buildClubInputs();
  updateElevUI();
  updateWindUI();
  loadSaved();
  
  qs('elev').addEventListener('input', ()=>{ updateElevUI(); });
  qs('wind').addEventListener('input', ()=>{ updateWindUI(); });
  
  // ë¯¸ì„¸ì¡°ì • ë²„íŠ¼ ì´ë²¤íŠ¸
  document.querySelectorAll('.fine-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const target = e.target.dataset.target;
      const amount = parseFloat(e.target.dataset.amount);
      
      const input = qs(target);
      let currentValue = parseFloat(input.value);
      let newValue = currentValue + amount;
      
      // ë²”ìœ„ ì œí•œ
      const min = parseFloat(input.min);
      const max = parseFloat(input.max);
      newValue = Math.max(min, Math.min(max, newValue));
      
      // ì†Œìˆ˜ì  1ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼
      newValue = Math.round(newValue * 10) / 10;
      
      input.value = newValue;
      
      // UI ì—…ë°ì´íŠ¸
      if(target === 'elev'){
        updateElevUI();
      } else if(target === 'wind'){
        updateWindUI();
      }
    });
  });
  
  // ë°”ëŒ ì²´í¬ë°•ìŠ¤ ìƒí˜¸ ë°°íƒ€ì  ì²˜ë¦¬ (ë§ë°”ëŒê³¼ ë’·ë°”ëŒ)
  qs('headwind').addEventListener('change', (e)=>{
    if(e.target.checked){
      qs('tailwind').checked = false;
    }
  });
  
  qs('tailwind').addEventListener('change', (e)=>{
    if(e.target.checked){
      qs('headwind').checked = false;
    }
  });
  
  // ìŒì„± ì¸ì‹ ê¸°ëŠ¥
  qs('voiceBtn').addEventListener('click', startVoiceRecognition);
  
  qs('openClubBtn').addEventListener('click', ()=>{ 
    qs('clubModal').style.display='flex'; 
    qs('clubModal').setAttribute('aria-hidden','false'); 
    loadSaved(); 
  });
  
  qs('closeModal').addEventListener('click', ()=>{ 
    qs('clubModal').style.display='none';
    qs('clubModal').setAttribute('aria-hidden','true'); 
  });
  
  qs('modalClose').addEventListener('click', ()=>{ 
    qs('clubModal').style.display='none';
    qs('clubModal').setAttribute('aria-hidden','true'); 
  });
  
  qs('saveClubs').addEventListener('click', ()=>{ 
    clubs.forEach(c=>{
      const v = qs('ci_' + c).value;
      clubDistances[c] = v === '' ? null : parseFloat(v);
    });
    saveClubsToStorage();
    updateClubDisplay();
    alert('í´ëŸ½ ê±°ë¦¬ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    qs('clubModal').style.display='none';
    qs('clubModal').setAttribute('aria-hidden','true');
  });
  
  qs('calcBtn').addEventListener('click', computeAndShow);
});

// ìŒì„± ì¸ì‹ í•¨ìˆ˜
function startVoiceRecognition(){
  // Web Speech API ì§€ì› í™•ì¸
  if(!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)){
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome, Edge, Safarië¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
    return;
  }
  
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();
  
  recognition.lang = 'ko-KR';
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.maxAlternatives = 5; // ì—¬ëŸ¬ í›„ë³´ ë°›ê¸°
  
  // ìŒì„± ì¸ì‹ ì‹œì‘
  qs('voiceStatus').style.display = 'block';
  
  recognition.onresult = (event) => {
    // ëª¨ë“  ì¸ì‹ í›„ë³´ ìˆ˜ì§‘
    const results = event.results[0];
    let bestTranscript = results[0].transcript;
    let bestConfidence = results[0].confidence;
    
    console.log('ì¸ì‹ ê²°ê³¼:');
    for(let i = 0; i < results.length; i++){
      console.log(`  í›„ë³´ ${i+1}: "${results[i].transcript}" (ì‹ ë¢°ë„: ${results[i].confidence})`);
    }
    
    // ê°€ì¥ ë†’ì€ ì‹ ë¢°ë„ì˜ ê²°ê³¼ ì‚¬ìš©
    for(let i = 0; i < results.length; i++){
      if(results[i].confidence > bestConfidence){
        bestTranscript = results[i].transcript;
        bestConfidence = results[i].confidence;
      }
    }
    
    console.log(`ìµœì¢… ì„ íƒ: "${bestTranscript}" (ì‹ ë¢°ë„: ${bestConfidence})`);
    
    // ìë™ êµì • ì ìš©
    const correctedText = autoCorrectVoice(bestTranscript);
    console.log('êµì • í›„:', correctedText);
    
    parseVoiceCommand(correctedText, bestConfidence);
    qs('voiceStatus').style.display = 'none';
  };
  
  recognition.onerror = (event) => {
    console.error('ìŒì„± ì¸ì‹ ì˜¤ë¥˜:', event.error);
    qs('voiceStatus').style.display = 'none';
    
    let errorMsg = 'ìŒì„± ì¸ì‹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
    if(event.error === 'no-speech'){
      errorMsg = 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
    } else if(event.error === 'audio-capture'){
      errorMsg = 'ë§ˆì´í¬ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë§ˆì´í¬ ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
    } else if(event.error === 'not-allowed'){
      errorMsg = 'ë§ˆì´í¬ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
    }
    
    alert(errorMsg);
  };
  
  recognition.onend = () => {
    qs('voiceStatus').style.display = 'none';
  };
  
  recognition.start();
}

// ìŒì„± ì¸ì‹ ìë™ êµì • í•¨ìˆ˜
function autoCorrectVoice(text){
  let corrected = text;
  
  // ê³µë°± ì •ê·œí™”
  corrected = corrected.replace(/\s+/g, ' ').trim();
  
  // ìˆ«ì í•œê¸€ â†’ ì•„ë¼ë¹„ì•„ ìˆ«ì ë³€í™˜
  const numberMap = {
    'ì˜': '0', 'ê³µ': '0',
    'ì¼': '1', 'ì´': '2', 'ì‚¼': '3', 'ì‚¬': '4', 'ì˜¤': '5',
    'ìœ¡': '6', 'ì¹ ': '7', 'íŒ”': '8', 'êµ¬': '9'
  };
  
  // "ë°±ì˜¤ì‹­" â†’ "150" ê°™ì€ ë³µí•© ìˆ«ì ì²˜ë¦¬
  corrected = corrected.replace(/ë°±\s*(\d+)/g, (match, p1) => `1${p1}`);
  corrected = corrected.replace(/ë°±/g, '100');
  
  // í•œê¸€ ìˆ«ìë¥¼ ì•„ë¼ë¹„ì•„ ìˆ«ìë¡œ
  for(let [kr, num] of Object.entries(numberMap)){
    const regex = new RegExp(kr, 'g');
    corrected = corrected.replace(regex, num);
  }
  
  // ì—°ì†ëœ ìˆ«ì í•©ì¹˜ê¸°: "ì¼ ì˜¤ ê³µ" â†’ "150"
  corrected = corrected.replace(/(\d)\s+(\d)/g, '$1$2');
  
  // í”í•œ ì˜¤ì¸ì‹ êµì •
  const corrections = {
    // ë°”ëŒ ê´€ë ¨
    'ë§›ë°”ëŒ': 'ë§ë°”ëŒ',
    'ë§ ë°”ëŒ': 'ë§ë°”ëŒ',
    'ë’¤ë°”ëŒ': 'ë’·ë°”ëŒ',
    'ë’· ë°”ëŒ': 'ë’·ë°”ëŒ',
    'ì˜† ë°”ëŒ': 'ì˜†ë°”ëŒ',
    'ì—­ í’': 'ì—­í’',
    'ìˆœ í’': 'ìˆœí’',
    
    // ê±°ë¦¬ ê´€ë ¨
    'ë¯¸ í„°': 'ë¯¸í„°',
    'mm': 'm',
    'M': 'm',
    
    // ê³ ì €ì°¨ ê´€ë ¨
    'ì˜¤ ë¥´ë§‰': 'ì˜¤ë¥´ë§‰',
    'ë‚´ ë¦¬ë§‰': 'ë‚´ë¦¬ë§‰',
    'ì˜¬ë¼ê°€': 'ì˜¤ë¥´ë§‰',
    'ë‚´ë ¤ê°€': 'ë‚´ë¦¬ë§‰',
    
    // ë¼ì´ ê´€ë ¨
    'í˜ì–´': 'í˜ì–´ì›¨ì´',
    'í˜ì–´ ì›¨ì´': 'í˜ì–´ì›¨ì´',
    'ëŸ¬ í”„': 'ëŸ¬í”„',
    'ë²™ ì»¤': 'ë²™ì»¤',
    
    // í•€ ê´€ë ¨
    'ì• í•€': 'ì•í•€',
    'ë’· í•€': 'ë’·í•€',
    'ì¤‘ í•€': 'ì¤‘í•€',
    'ì¤‘ ì•™': 'ì¤‘ì•™'
  };
  
  for(let [wrong, right] of Object.entries(corrections)){
    const regex = new RegExp(wrong, 'gi');
    corrected = corrected.replace(regex, right);
  }
  
  // ìœ ì‚¬ ë°œìŒ êµì • (ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ ê¸°ë°˜)
  const keywords = ['ë§ë°”ëŒ', 'ë’·ë°”ëŒ', 'ì˜†ë°”ëŒ', 'í˜ì–´ì›¨ì´', 'ëŸ¬í”„', 'ë²™ì»¤', 'ì•í•€', 'ì¤‘í•€', 'ë’·í•€', 'ì˜¤ë¥´ë§‰', 'ë‚´ë¦¬ë§‰'];
  const words = corrected.split(' ');
  
  for(let i = 0; i < words.length; i++){
    for(let keyword of keywords){
      if(similarity(words[i], keyword) > 0.7){
        words[i] = keyword;
        break;
      }
    }
  }
  
  corrected = words.join(' ');
  
  return corrected;
}

// ë¬¸ìì—´ ìœ ì‚¬ë„ ê³„ì‚° (0~1)
function similarity(s1, s2){
  const longer = s1.length > s2.length ? s1 : s2;
  const shorter = s1.length > s2.length ? s2 : s1;
  
  if(longer.length === 0) return 1.0;
  
  const editDistance = levenshteinDistance(longer, shorter);
  return (longer.length - editDistance) / longer.length;
}

// ë ˆë²¤ìŠˆíƒ€ì¸ ê±°ë¦¬ ê³„ì‚°
function levenshteinDistance(s1, s2){
  const costs = [];
  for(let i = 0; i <= s1.length; i++){
    let lastValue = i;
    for(let j = 0; j <= s2.length; j++){
      if(i === 0){
        costs[j] = j;
      } else if(j > 0){
        let newValue = costs[j - 1];
        if(s1.charAt(i - 1) !== s2.charAt(j - 1)){
          newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
        }
        costs[j - 1] = lastValue;
        lastValue = newValue;
      }
    }
    if(i > 0) costs[s2.length] = lastValue;
  }
  return costs[s2.length];
}

// ìŒì„± ëª…ë ¹ íŒŒì‹± í•¨ìˆ˜ (ê°œì„ )
function parseVoiceCommand(text, confidence){
  console.log('íŒŒì‹± ì‹œì‘:', text, '(ì‹ ë¢°ë„:', confidence, ')');
  
  let result = {
    distance: null,
    elevation: null,
    windSpeed: null,
    headwind: false,
    tailwind: false,
    crosswind: false,
    lie: null,
    pin: null
  };
  
  // ê±°ë¦¬ ì¸ì‹ (ë‹¤ì¤‘ íŒ¨í„´)
  let distanceMatch = text.match(/(\d+)\s*(?:ë¯¸í„°|m|M)/);
  if(!distanceMatch){
    // "ì¼ì˜¤ê³µë¯¸í„°" ê°™ì€ íŒ¨í„´ë„ ì‹œë„
    distanceMatch = text.match(/(\d{2,3})\s*(?:ë¯¸í„°|m)/);
  }
  if(distanceMatch){
    result.distance = parseInt(distanceMatch[1]);
  }
  
  // ê³ ì €ì°¨ ì¸ì‹ (ë‹¤ì¤‘ íŒ¨í„´)
  const elevUpMatch = text.match(/(?:ì˜¤ë¥´ë§‰|ì˜¬ë¼|í”ŒëŸ¬ìŠ¤)\s*(\d+)/);
  const elevDownMatch = text.match(/(?:ë‚´ë¦¬ë§‰|ë‚´ë ¤|ë§ˆì´ë„ˆìŠ¤)\s*(\d+)/);
  
  if(elevUpMatch){
    result.elevation = parseInt(elevUpMatch[1]);
  } else if(elevDownMatch){
    result.elevation = -parseInt(elevDownMatch[1]);
  }
  
  // ë°”ëŒ ë°©í–¥ ì¸ì‹ (ì—¬ëŸ¬ í‘œí˜„)
  if(text.includes('ë§ë°”ëŒ') || text.includes('ì—­í’') || text.includes('ì•ë°”ëŒ')){
    result.headwind = true;
  }
  if(text.includes('ë’·ë°”ëŒ') || text.includes('ìˆœí’') || text.includes('ë’¤ë°”ëŒ')){
    result.tailwind = true;
  }
  if(text.includes('ì˜†ë°”ëŒ') || text.includes('íš¡í’') || text.includes('ì‚¬ì´ë“œ')){
    result.crosswind = true;
  }
  
  // í’ì† ì¸ì‹ (ë‹¤ì¤‘ íŒ¨í„´)
  let windMatch = text.match(/(?:ë°”ëŒ|í’ì†)\s*(\d+)/);
  if(!windMatch){
    // "ë§ë°”ëŒ 5" ê°™ì€ íŒ¨í„´
    windMatch = text.match(/(?:ë§ë°”ëŒ|ë’·ë°”ëŒ|ì—­í’|ìˆœí’|ì˜†ë°”ëŒ)\s*(\d+)/);
  }
  if(windMatch){
    result.windSpeed = parseInt(windMatch[1]);
  }
  
  // ë¼ì´ ì¸ì‹ (ë¶€ë¶„ ì¼ì¹˜ í—ˆìš©)
  if(text.includes('í˜ì–´ì›¨ì´') || text.includes('í˜ì–´') || text.includes('fairway')){
    result.lie = 'í˜ì–´ì›¨ì´';
  } else if(text.includes('ëŸ¬í”„') || text.includes('rough')){
    result.lie = 'ëŸ¬í”„';
  } else if(text.includes('ë²™ì»¤') || text.includes('bunker') || text.includes('ëª¨ë˜')){
    result.lie = 'ë²™ì»¤';
  }
  
  // í•€ ìœ„ì¹˜ ì¸ì‹ (ë‹¤ì¤‘ í‘œí˜„)
  if(text.includes('ì•í•€') || text.includes('ì•') || text.includes('í”„ë¡ íŠ¸')){
    result.pin = 'ì•í•€';
  } else if(text.includes('ë’·í•€') || text.includes('ë’¤') || text.includes('ë°±')){
    result.pin = 'ë’·í•€';
  } else if(text.includes('ì¤‘ì•™') || text.includes('ì¤‘í•€') || text.includes('ì„¼í„°') || text.includes('ê°€ìš´ë°')){
    result.pin = 'ì¤‘ì•™';
  }
  
  // ì‹ ë¢°ë„ê°€ ë‚®ìœ¼ë©´ í™•ì¸ ìš”ì²­
  if(confidence < 0.7){
    showConfirmDialog(result, text);
  } else {
    applyVoiceResult(result);
  }
}

// í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ
function showConfirmDialog(result, originalText){
  const recognizedItems = [];
  
  if(result.distance) recognizedItems.push(`ê±°ë¦¬: ${result.distance}m`);
  if(result.elevation) recognizedItems.push(`ê³ ì €ì°¨: ${result.elevation > 0 ? '+' : ''}${result.elevation}m`);
  if(result.windSpeed) recognizedItems.push(`í’ì†: ${result.windSpeed} m/s`);
  if(result.headwind) recognizedItems.push(`ë§ë°”ëŒ`);
  if(result.tailwind) recognizedItems.push(`ë’·ë°”ëŒ`);
  if(result.crosswind) recognizedItems.push(`ì˜†ë°”ëŒ`);
  if(result.lie) recognizedItems.push(`ë¼ì´: ${result.lie}`);
  if(result.pin) recognizedItems.push(`í•€: ${result.pin}`);
  
  const message = `ì¸ì‹ëœ ë‚´ìš©:\n\n${recognizedItems.join('\n')}\n\nì›ë¬¸: "${originalText}"\n\nì´ëŒ€ë¡œ ì ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
  
  if(confirm(message)){
    applyVoiceResult(result);
  } else {
    alert('ìŒì„± ì¸ì‹ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
  }
}

// ìŒì„± ì¸ì‹ ê²°ê³¼ë¥¼ UIì— ì ìš©
function applyVoiceResult(result){
  let applied = [];
  
  if(result.distance !== null){
    qs('tgt').value = result.distance;
    applied.push(`ê±°ë¦¬ ${result.distance}m`);
  }
  
  if(result.elevation !== null){
    qs('elev').value = result.elevation;
    updateElevUI();
    applied.push(`ê³ ì €ì°¨ ${result.elevation > 0 ? '+' : ''}${result.elevation}m`);
  }
  
  if(result.windSpeed !== null){
    qs('wind').value = result.windSpeed;
    updateWindUI();
    applied.push(`í’ì† ${result.windSpeed} m/s`);
  }
  
  if(result.headwind){
    qs('headwind').checked = true;
    qs('tailwind').checked = false;
    applied.push('ë§ë°”ëŒ');
  }
  
  if(result.tailwind){
    qs('tailwind').checked = true;
    qs('headwind').checked = false;
    applied.push('ë’·ë°”ëŒ');
  }
  
  if(result.crosswind){
    qs('crosswind').checked = true;
    applied.push('ì˜†ë°”ëŒ');
  }
  
  if(result.lie !== null){
    qs('lie').value = result.lie;
    applied.push(`ë¼ì´: ${result.lie}`);
  }
  
  if(result.pin !== null){
    qs('pin').value = result.pin;
    applied.push(`í•€: ${result.pin}`);
  }
  
  if(applied.length > 0){
    alert('âœ… ì ìš© ì™„ë£Œ:\n' + applied.join('\n'));
  } else {
    alert('ì¸ì‹ëœ ê°’ì´ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.\n\nğŸ“Œ ì˜ˆì‹œ: "140ë¯¸í„° ë’·ë°”ëŒ 3 ì˜¤ë¥´ë§‰ 10 ëŸ¬í”„ ì¤‘í•€"');
  }
}

// Service Worker ë“±ë¡
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker ë“±ë¡ ì„±ê³µ:', reg.scope))
      .catch(err => console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err));
  });
}
</script>
</body>
</html>